import{F as B}from"./index.69ee1880.js";import{c as S}from"./create.af6e9796.js";import{t as d,a as b,r as R,b as C}from"./shared.285cd5cf.js";/* empty css               */import{c as V}from"./relation.9e421618.js";import{a as w}from"./elements.aa4184a2.js";const Z=t=>["normal","small","mini"].includes(t),_={value:{type:[Number,Array],default:0},label:{type:[String,Number]},size:{type:String,default:"normal",validator:Z},min:{type:[String,Number],default:0},max:{type:[String,Number],default:100},step:{type:[String,Number],default:1},range:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},verticalHeight:{type:[Number,String]},validateTrigger:{type:Array,default:()=>["onChange"]},rules:{type:Array}};const{createComponent:M,namespace:i}=S("slider"),L=300,O=M({mixins:[V("form",{parentKey:"form",childrenKey:"formComponents"})],props:_,data:()=>({touching:!1,ratio:0,stepRatio:0,trackLeft:void 0,trackTop:void 0,trackWidth:void 0,trackHeight:void 0,buttonZIndex:1,reverseButtonZIndex:1,reverseRatio:0,showTooltip:!1,showReverseTooltip:!1,tooltipCloser:null,errorMessage:""}),computed:{fullStep(){return d(this.max)-d(this.min)},minNum(){return d(this.min)},maxNum(){return d(this.max)}},watch:{value:{handler(){this.$nextTick(()=>{const t=this.minNum,e=this.maxNum;if(!this.normalizeValue())if(this.range){const[s,r]=this.value;this.ratio=(s-t)/this.fullStep*100,this.reverseRatio=(e-r)/this.fullStep*100}else this.ratio=(this.value-t)/this.fullStep*100})},immediate:!0}},beforeDestroy(){document.removeEventListener("touchmove",this.handleTouchmove),document.removeEventListener("touchend",this.handleTouchend)},methods:{reset(){this.$emit("input",this.range?[this.minNum,this.maxNum]:this.minNum),this.resetValidation()},validate(){this.$refs.formItem.validate()},resetValidation(){this.$refs.formItem.resetValidation()},nextTickValidateWithTrigger(t){this.$nextTick(()=>{var e;(e=this.$refs.formItem)==null||e.validateWithTrigger(this.validateTrigger,t,this.rules,this.value)})},handleTouchstart(t){var r,o;if(this.disabled||((r=this.form)==null?void 0:r.disabled)||this.readonly||((o=this.form)==null?void 0:o.readonly))return;document.addEventListener("touchmove",this.handleTouchmove,{passive:!1}),document.addEventListener("touchend",this.handleTouchend),this.resize(),this.touching=!0;const{clientX:e,clientY:s}=t.touches[0];this.move(e,s)},handleTouchmove(t){if(t.preventDefault(),!this.touching)return;const{clientX:e,clientY:s}=t.touches[0];this.move(e,s)},handleTouchend(){document.removeEventListener("touchmove",this.handleTouchmove),document.removeEventListener("touchend",this.handleTouchend),this.touching=!1,this.buttonZIndex=1,this.reverseButtonZIndex=1,this.closeTooltip()},normalizeValue(){const t=this.minNum,e=this.maxNum;if(this.range){if(!b(this.value)||b(this.value)&&this.value.length!==2)return this.$emit("input",[t,e]),!0;const[s,r]=this.value;if(s<t||r>e)return this.$emit("input",[R(s,t,e),R(r,t,e)]),!0}else if(!C(this.value)||this.value<t||this.value>e)return this.$emit("input",t),!0},getNext(t,e,s,r,o={}){var g,x,T;const u=(g=o.reverse)!=null?g:!1,l=(x=o.minValue)!=null?x:this.minNum,a=(T=o.maxValue)!=null?T:this.maxNum,m=d(this.step),{maxRatio:v=100,minRatio:h=0}=o,p=this.getMouseRatio(t,e,u);let n,c;if(p>=v)n=v,c=a;else if(p<=h)n=h,c=l;else{const f=this.getStepCount(p,r);n=R(r+f*this.stepRatio,h,v),c=R(s+f*m,l,a)}return{nextRatio:n,nextValue:c}},getMouseRatio(t,e,s=!1){const r=s?this.trackLeft+this.trackWidth-t:t-this.trackLeft,o=s?e-this.trackTop:this.trackTop+this.trackHeight-e;return(this.vertical?o/this.trackHeight:r/this.trackWidth)*100},shouldMoveReverse(t,e){const s=this.getMouseRatio(t,e),r=s-(100-this.reverseRatio),o=s-this.ratio;return this.reverseButtonZIndex>this.buttonZIndex?!0:this.reverseButtonZIndex<this.buttonZIndex?!1:r>0?!0:o<0?!1:Math.abs(r)<=Math.abs(o)},move(t,e){if(this.range){const o=this.value[0];let u=this.value[1];if(this.shouldMoveReverse(t,e)){this.pullUpReverseButton(),u=this.maxNum+this.minNum-u;const{nextRatio:l,nextValue:a}=this.getNext(t,e,u,this.reverseRatio,{maxValue:this.maxNum+this.minNum-o,maxRatio:100-this.ratio,reverse:!0});if(this.reverseRatio===l||u===a)return;this.reverseRatio=l;const m=this.maxNum+this.minNum-a;this.$emit("input",[o,m]),this.$emit("change",[o,m])}else{this.pullUpButton();const{nextRatio:l,nextValue:a}=this.getNext(t,e,o,this.ratio,{maxValue:u,maxRatio:100-this.reverseRatio});if(this.ratio===l||o===a)return;this.ratio=l,this.$emit("input",[a,u]),this.$emit("change",[a,u])}this.nextTickValidateWithTrigger("onChange");return}const{nextRatio:s,nextValue:r}=this.getNext(t,e,this.value,this.ratio);this.ratio===s||this.value===r||(this.ratio=s,this.showTooltip=!0,this.$emit("input",r),this.$emit("change",r),this.nextTickValidateWithTrigger("onChange"))},resize(){this.trackLeft=this.$refs.track.getBoundingClientRect().left,this.trackTop=this.$refs.track.getBoundingClientRect().top,this.trackWidth=this.$refs.track.offsetWidth,this.trackHeight=this.$refs.track.offsetHeight,this.stepRatio=d(this.step)/this.fullStep*100},getStepCount(t,e){return Math.round((t-e)/this.stepRatio)},getButtonStyle(){return this.vertical?{bottom:`${this.ratio}%`,zIndex:this.buttonZIndex}:{left:`${this.ratio}%`,zIndex:this.buttonZIndex}},getReverseButtonStyle(){return this.vertical?{top:`${this.reverseRatio}%`,zIndex:this.reverseButtonZIndex}:{right:`${this.reverseRatio}%`,zIndex:this.reverseButtonZIndex}},getRailStyle(){return this.vertical?{height:`${this.ratio}%`}:{width:`${this.ratio}%`}},getReverseRailStyle(){return this.vertical?{height:`${this.reverseRatio}%`}:{width:`${this.reverseRatio}%`}},pullUpButton(){clearTimeout(this.tooltipCloser),this.buttonZIndex=2,this.reverseButtonZIndex=1,this.showTooltip=!0,this.showReverseTooltip=!1},pullUpReverseButton(){clearTimeout(this.tooltipCloser),this.buttonZIndex=1,this.reverseButtonZIndex=2,this.showTooltip=!1,this.showReverseTooltip=!0},openTooltip(){var t;this.disabled||((t=this.form)==null?void 0:t.disabled)||(clearTimeout(this.tooltipCloser),this.showTooltip=!0)},openReverseTooltip(){var t;this.disabled||((t=this.form)==null?void 0:t.disabled)||(clearTimeout(this.tooltipCloser),this.showReverseTooltip=!0)},closeTooltip(){clearTimeout(this.tooltipCloser),this.tooltipCloser=setTimeout(()=>{this.showTooltip=!1,this.showReverseTooltip=!1},L)},handleErrorMessageChange(t){this.errorMessage=t},handleClick(t){var e;((e=this.form)==null?void 0:e.disabled)||this.disabled||(this.$emit("click",t),this.nextTickValidateWithTrigger("onClick"))}},render(){const t=arguments[0],{form:e,value:s,label:r,disabled:o,rules:u,size:l,errorMessage:a,showTooltip:m,showReverseTooltip:v,vertical:h,verticalHeight:p,range:n,getButtonStyle:c,getReverseButtonStyle:g,getRailStyle:x,getReverseRailStyle:T,closeTooltip:f,openTooltip:y,openReverseTooltip:k,handleTouchstart:$,handleErrorMessageChange:N,handleClick:I}=this;return t(B,{ref:"formItem",attrs:{label:r,value:s,rules:u},on:{"error-message-change":N}},[t("div",{class:[i(),"m--box",h?i("--vertical"):null,o||(e==null?void 0:e.disabled)?i("--disabled"):null],on:{click:I}},[t("div",{ref:"track",class:[i("__track"),i(`--${l}-track`),h?i(`--${l}-track-vertical`):null,n?i("--track-range"):null,n&&a?i("--error"):null],style:{height:h?w(p):void 0},on:{touchstart:$}},[t("div",{class:[i("__button"),i(`--${l}-button`),h?i("--button-vertical"):null,a?i("--error"):null],style:c(),on:{mouseenter:y,mouseleave:f}},[t("div",{class:[i("__tooltip"),i(`--${l}-tooltip`),h?i("--tooltip-vertical"):null,a?i("--tooltip-error"):null],style:{opacity:m?1:0}},[n?s[0]:s])]),t("div",{class:[i("__rail"),h?i("--rail-vertical"):null,!n&&a?i("--error"):null,n?i("--rail-range"):null],style:x()}),n&&t("div",{class:[i("__reverse-button"),i(`--${l}-button`),this.vertical?i("--reverse-button-vertical"):null,a?i("--error"):null],style:g(),on:{mouseenter:k,mouseleave:f}},[t("div",{class:[i("__tooltip"),i(`--${l}-tooltip`),h?i("--tooltip-vertical"):null,a?i("--tooltip-error"):null],style:{opacity:v?1:0}},[s[1]])]),n&&t("div",{class:[i("__reverse-rail"),h?i("--reverse-rail-vertical"):null,n?i("--reverse-rail-range"):null],style:T()})])])])}});export{O as S};
