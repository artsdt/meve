var w=Object.defineProperty;var z=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var g=(t,a,e)=>a in t?w(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,h=(t,a)=>{for(var e in a||(a={}))b.call(a,e)&&g(t,e,a[e]);if(z)for(var e of z(a))I.call(a,e)&&g(t,e,a[e]);return t};import{h as O,j as R}from"./elements.024da98f.js";import{e as C,n as _,o as G}from"./shared.c7f62d01.js";const N="background-image",W="lazy-loading",B="lazy-error",p="lazy-attempt",P=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],f="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",s=[],A=[],E=G(100),n={loading:f,error:f,attempt:3,throttleWait:300,events:P};let m=_(i,n.throttleWait);function l(t,a){t._lazy.arg===N?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function T(t){t._lazy.loading&&l(t,t._lazy.loading),i()}function D(t){t._lazy.error&&l(t,t._lazy.error),t._lazy.state="error",d(t),i()}function L(t,a){l(t,a),t._lazy.state="success",d(t),i()}function M(t){var a;A.includes(t)||(A.push(t),(a=n.events)==null||a.forEach(e=>{t.addEventListener(e,m,{passive:!0})}))}function S(){A.forEach(t=>{var a;(a=n.events)==null||a.forEach(e=>{t.removeEventListener(e,m)})}),A.length=0}function Y(t,a){var o,c,u;const e={loading:(o=t.getAttribute(W))!=null?o:n.loading,error:(c=t.getAttribute(B))!=null?c:n.error,attempt:t.getAttribute(p)?Number(t.getAttribute(p)):n.attempt},r=Object.assign(t,{_lazy:h({src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1},e)});return l(r,f),(u=n.filter)==null||u.call(n,r._lazy),r}function Z(t,a){const e=new Image;e.src=a,t._lazy.preloadImage=e,e.addEventListener("load",()=>{t._lazy.attemptLock=!1,E.add(a),L(t,a)}),e.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?D(t):v(t)})}function v(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(E.has(a)){L(t,a),t._lazy.attemptLock=!1;return}T(t),Z(t,a)}async function y(t){await O(t)&&v(t)}function i(){s.forEach(t=>y(t))}async function j(t){!s.includes(t)&&s.push(t),R(t).forEach(M),await y(t)}function d(t){C(s,t),s.length===0&&S()}function V(t,a){const{src:e,arg:r}=t._lazy;return e!==a.value||r!==a.arg}async function k(t,a){await j(Y(t,a))}async function x(t,a){const e=t;if(!V(e,a)){s.includes(e)&&await y(e);return}await k(t,a)}function H(t={}){const{events:a,loading:e,error:r,attempt:o,throttleWait:c,filter:u}=t;n.events=a!=null?a:n.events,n.loading=e!=null?e:n.loading,n.error=r!=null?r:n.error,n.attempt=o!=null?o:n.attempt,n.throttleWait=c!=null?c:n.throttleWait,n.filter=u}const X={inserted:k,unbind:d,update:x,install(t,a){H(a),m=_(i,n.throttleWait),t.directive("lazy",this)}};export{X as L};
