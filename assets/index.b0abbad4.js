import{c as v}from"./create.d5ed34a6.js";import{a as w,c as I}from"./relation.9e421618.js";import{t as p,b as S}from"./shared.c7f62d01.js";/* empty css               */const z={loop:{type:Boolean,default:!0},autoplay:{type:[String,Number]},duration:{type:[String,Number],default:300},initialIndex:{type:[String,Number],default:0},indicator:{type:Boolean,default:!0},indicatorColor:{type:String},vertical:{type:Boolean,default:!1},touchable:{type:Boolean,default:!0}};const{namespace:h,createComponent:y}=v("swipe"),k=250,b=20,E=y({mixins:[w("swipe")],props:z,data:()=>({size:0,trackSize:0,sizeUnit:0,trackSizeUnit:0,translate:0,lockDuration:!1,index:0,touching:!1,timer:-1,startX:void 0,startY:void 0,startTime:void 0,prevX:void 0,prevY:void 0}),computed:{length(){return this.children.length}},watch:{children(){this.initIndex(),this.resize()}},mounted(){window.addEventListener("resize",this.resize)},beforeDestroy(){window.removeEventListener("resize",this.resize),this.stopAutoplay()},methods:{findSwipeItem(t){return this.children.find(({index:e})=>e===t)},dispatchBorrower(){const{translate:t,trackSize:e,size:i,loop:r,children:n}=this,{length:s}=n;!r||(t>=0&&(this.findSwipeItem(s-1).translate=-e),t<=-(e-i)&&(this.findSwipeItem(0).translate=e),t>-(e-i)&&t<0&&(this.findSwipeItem(s-1).translate=0,this.findSwipeItem(0).translate=0))},getSwipeIndex(t){const{translate:e,size:i,loop:r,length:n}=this,s=S(t)?t:Math.floor((e-i/2)/-i);return s<=-1?r?-1:0:s>=n?r?n:n-1:s},swipeIndexToIndex(t){const{loop:e,length:i}=this;return t===-1?e?i-1:0:t===i?e?0:i-1:t},boundaryIndex(t){const{loop:e,length:i}=this;return t<0?e?i-1:0:t>i-1?e?0:i-1:t},fixPosition(t){const{translate:e,size:i,length:r,trackSize:n}=this,s=e>=i,o=e<=-n,a=0,c=-(n-i);this.lockDuration=!0,(s||o)&&(this.lockDuration=!0,this.translate=o?a:c,this.findSwipeItem(0).translate=0,this.findSwipeItem(r-1).translate=0),requestAnimationFrame(()=>{this.lockDuration=!1,t()})},initIndex(){this.index=this.boundaryIndex(p(this.initialIndex)),this.resize()},startAutoplay(){const{autoplay:t,length:e}=this;!t||e<=1||(this.stopAutoplay(),this.timer=window.setTimeout(()=>{this.next(),this.startAutoplay()},p(t)))},stopAutoplay(){this.timer&&clearTimeout(this.timer)},getDirection(t,e){if(t>e&&t>10)return"horizontal";if(e>t&&e>10)return"vertical"},handleTouchstart(t){if(this.length<=1||!this.touchable)return;const{clientX:e,clientY:i}=t.touches[0];this.startX=e,this.startY=i,this.startTime=performance.now(),this.touching=!0,this.stopAutoplay(),this.fixPosition(()=>{this.lockDuration=!0})},handleTouchmove(t){const{touchable:e,vertical:i,touching:r,startX:n,startY:s,prevX:o,prevY:a}=this;if(!r||!e)return;const{clientX:c,clientY:l}=t.touches[0],d=Math.abs(c-n),f=Math.abs(l-s);if(this.getDirection(d,f)===(i?"vertical":"horizontal")){t.preventDefault();const g=o!==void 0?c-o:0,x=a!==void 0?l-a:0;this.prevX=c,this.prevY=l,this.translate+=i?x:g,this.dispatchBorrower()}},handleTouchend(){const{touching:t,vertical:e,startX:i,startY:r,prevX:n,prevY:s,startTime:o,index:a,size:c}=this;if(!t)return;const l=e?s<r:n<i,d=Math.abs(e?r-s:i-n),u=performance.now()-o<=k&&d>=b?l?this.getSwipeIndex(a+1):this.getSwipeIndex(a-1):this.getSwipeIndex();this.touching=!1,this.lockDuration=!1,this.prevX=void 0,this.prevY=void 0,this.translate=u*-c;const m=a;this.index=this.swipeIndexToIndex(u),this.startAutoplay(),m!==this.index&&this.$emit("change",this.index)},resize(){this.lockDuration=!0;const{vertical:t,length:e,$refs:{swipe:i},index:r}=this;this.size=t?i.offsetHeight:i.offsetWidth,this.trackSize=this.size*e,this.translate=r*-this.size,this.children.forEach(n=>{n.translate=0}),this.startAutoplay(),setTimeout(()=>{this.lockDuration=!1})},next(){const{length:t,loop:e,index:i,trackSize:r,size:n}=this;if(t<=1)return;const s=i;this.index=this.boundaryIndex(s+1),this.$emit("change",this.index),this.fixPosition(()=>{if(s===t-1&&e){this.findSwipeItem(0).translate=r,this.translate=t*-n;return}s!==t-1&&(this.translate=this.index*-n)})},prev(){const{length:t,loop:e,index:i,trackSize:r,size:n}=this;if(t<=1)return;const s=i;this.index=this.boundaryIndex(s-1),this.$emit("change",this.index),this.fixPosition(()=>{if(s===0&&e){this.findSwipeItem(t-1).translate=-r,this.translate=n;return}s!==0&&(this.translate=this.index*-n)})},to(t){const{length:e,index:i}=this;if(e<=1||t===i)return;t=t<0?0:t,t=t>=e?e:t;const r=t>i?this.next:this.prev;Array.from({length:Math.abs(t-i)}).forEach(r)},renderIndicator(){const t=this.$createElement,{index:e,length:i,indicator:r,vertical:n,indicatorColor:s}=this;if(this.hasSlots("indicator"))return this.slots("indicator",{index:e,length:i});if(r&&i)return t("div",{class:[h("__indicators"),n?h("--indicators-vertical"):null]},[Array.from({length:i}).map((o,a)=>t("div",{key:a,class:[h("__indicator"),e===a?h("--indicator-active"):null,n?h("--indicator-vertical"):null],style:{background:s},on:{click:()=>this.to(a)}}))])}},render(){const t=arguments[0],{vertical:e,trackSize:i,translate:r,duration:n,lockDuration:s}=this;return t("div",{ref:"swipe",class:h()},[t("div",{class:[h("__track"),e?h("--vertical"):null],style:{width:e?void 0:`${i}px`,height:e?`${i}px`:void 0,transform:`translate${e?"Y":"X"}(${r}px)`,transitionDuration:s?"0ms":`${p(n)}ms`},on:{touchstart:this.handleTouchstart,touchmove:this.handleTouchmove,touchend:this.handleTouchend}},[this.slots()]),this.renderIndicator()])}});const{namespace:D,createComponent:T}=v("swipe-item"),P=T({mixins:[I("swipe")],data:()=>({translate:0}),render(){const t=arguments[0],{parent:e,translate:i}=this;return t("div",{class:D(),style:{width:e.vertical?void 0:`${e.size}px`,height:e.vertical?`${e.size}px`:void 0,transform:`translate${e.vertical?"Y":"X"}(${i}px)`}},[this.slots()])}});export{E as S,P as a};
