import{I as i}from"./index.c2868c0e.js";import{P as h}from"./index.fa8e81d3.js";import{R as u}from"./index.45eae9d1.js";import{B as s}from"./index.644136aa.js";import{I as p}from"./index.03505042.js";import{C as m}from"./index.3a0ae6c9.js";import{d,c as f}from"./vendor.b6844a64.js";import{K as v}from"./keyboardActive.acc7335a.js";import{c as g}from"./create.aa899411.js";import{c as y}from"./relation.9e421618.js";import{a as l,i as o}from"./shared.3ed6fcb1.js";/* empty css               *//* empty css                 */import"./index.f9508539.js";const b=e=>["normal","small","mini"].includes(e),_={value:{type:[String,Array]},label:{type:[String,Number]},size:{type:String,default:"normal",validator:b},placeholder:{type:String},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},valueFormat:{type:String,default:"YYYY-MM-DD"},range:{type:Boolean,default:!1},customDisabled:{type:Function,default:()=>!1},validateTrigger:{type:Array,default:()=>["onChange","onClear"]},rules:{type:Array}};d.extend(f);const{createComponent:k,namespace:r}=g("date-picker"),c="YYYY-MM-DD",$=" - ",V=130,B=k({mixins:[v,y("form",{parentKey:"form",childrenKey:"formComponents"})],props:_,directives:{Ripple:u},data:()=>({enterPopover:!1,keyboardDisabled:!1,id:void 0,localValue:void 0}),watch:{value:{handler(e){this.localValue=e},immediate:!0}},computed:{displayValue(){return this.range&&l(this.localValue)?this.localValue.map(this.formatValueToDisplay).join($):this.range&&!l(this.localValue)?"":o(this.localValue)?void 0:this.formatValueToDisplay(this.localValue)}},mounted(){this.id=this.$refs.input.id},methods:{reset(){this.$emit("input",this.range?[]:void 0),this.resetValidation()},validate(){return this.$refs.input.validate()},resetValidation(){this.$refs.input.resetValidation()},nextTickValidateWithTrigger(e){!this.validateTrigger.includes(e)||this.$nextTick(()=>{this.validate()})},nextMonth(){this.$refs.calendar.nextMonth()},prevMonth(){this.$refs.calendar.prevMonth()},nextYear(){this.$refs.calendar.nextYear()},prevYear(){this.$refs.calendar.prevYear()},slideTo(e){this.$refs.calendar.slideTo(e)},toNow(){this.$refs.calendar.toNow()},focus(){this.$refs.input.focus()},blur(){var e;(e=this.$refs.input)==null||e.blur()},open(){this.$refs.popover.show||(this.$refs.popover.open(),this.keyboardDisabled=!1)},close(){var e,t;!((e=this.$refs.popover)==null?void 0:e.show)||((t=this.$refs.popover)==null||t.close(),this.keyboardDisabled=!0)},invalidRangeValue(){return this.range&&(!l(this.localValue)||this.localValue.length!==2)},formatValueToDisplay(e){return d(e,this.valueFormat).format(c)},handleKeydownEscape(){this.confirm()},confirm(){const e=this.invalidRangeValue()?[]:this.localValue;this.value!==e&&(this.$emit("input",e),this.$emit("change",e),this.nextTickValidateWithTrigger("onChange")),this.close(),requestAnimationFrame(this.blur)},handleClick(e){var t,a;((t=this.form)==null?void 0:t.disabled)||this.disabled||(this.$emit("click",e),this.nextTickValidateWithTrigger("onClick"),!(((a=this.form)==null?void 0:a.readonly)||this.readonly)&&this.focus())},handleClear(){const e=this.range?[]:void 0;this.$emit("clear",e),this.$emit("input",e),this.$emit("change",e),this.nextTickValidateWithTrigger("onClear"),this.nextTickValidateWithTrigger("onChange")},handleFocus(e){var t,a;((t=this.form)==null?void 0:t.disabled)||this.disabled||(this.$emit("focus",e),!(((a=this.form)==null?void 0:a.readonly)||this.readonly)&&this.open())},handleBlur(e){this.$emit("blur",e),!this.enterPopover&&this.confirm()},handleMouseenter(){this.enterPopover=!0},handleMouseleave(){this.enterPopover=!1},withPressing(e){let t;function a(){e(),t&&clearInterval(t),document.removeEventListener("touchend",a)}return()=>{document.addEventListener("touchend",a),t=setInterval(()=>{e()},V)}},renderAppendIcon(){const e=this.$createElement,t=e(i,{attrs:{"date-picker-cover":!0,name:"calendar"},class:r("__calendar-icon")}),a=this.clearable&&e(i,{attrs:{"date-picker-cover":!0,name:"close-circle"},class:[r("__clear-icon"),o(this.value)?r("--hide-clear-icon"):null],on:{click:this.handleClear}});return e("div",{class:r("__append-icon"),on:{click:n=>n.stopPropagation()}},[a,this.hasSlots("append-icon")?this.slots("append-icon"):t])},renderInput(){var t;return this.$createElement(p,{attrs:{"date-picker-cover":!0,label:this.label,value:this.displayValue,validateValue:this.value,rules:this.rules,validateTrigger:this.validateTrigger,placeholder:this.placeholder,size:this.size,readonly:!0,disabled:((t=this.form)==null?void 0:t.disabled)||this.disabled},ref:"input",on:{clear:this.handleClear,focus:this.handleFocus,blur:this.handleBlur,click:this.handleClick},scopedSlots:{"prepend-icon":()=>this.slots("prepend-icon"),"append-icon":this.renderAppendIcon}})},renderCalendarHeader({current:e}){const t=this.$createElement;return t("div",{class:r("__calendar-header"),on:{click:this.focus}},[t(s,{class:r("__calendar-button"),attrs:{"date-picker-cover":!0,round:!0,text:!0},on:{touchstart:this.withPressing(this.prevYear)}},[t(i,{class:r("__calendar-arrow-icon"),attrs:{"date-picker-cover":!0,name:"arrow-left"}})]),t(s,{class:r("__calendar-button"),attrs:{"date-picker-cover":!0,round:!0,text:!0},on:{touchstart:this.withPressing(this.prevMonth)}},[t(i,{class:r("__calendar-arrow-icon"),attrs:{"date-picker-cover":!0,name:"chevron-left"}})]),t("div",{class:r("__calendar-month-panel")},[e.format(c)]),t(s,{class:r("__calendar-button"),attrs:{"date-picker-cover":!0,round:!0,text:!0},on:{touchstart:this.withPressing(this.nextMonth)}},[t(i,{class:r("__calendar-arrow-icon"),attrs:{"date-picker-cover":!0,name:"chevron-right"}})]),t(s,{class:r("__calendar-button"),attrs:{"date-picker-cover":!0,round:!0,text:!0},on:{touchstart:this.withPressing(this.nextYear)}},[t(i,{class:r("__calendar-arrow-icon"),attrs:{"date-picker-cover":!0,name:"arrow-right"}})])])},renderCalendar(){var t,a;return this.$createElement(m,{class:r("__calendar"),attrs:{"date-picker-cover":!0,disabled:((t=this.form)==null?void 0:t.disabled)||this.disabled,readonly:((a=this.form)==null?void 0:a.readonly)||this.readonly,value:this.localValue,valueFormat:this.valueFormat,range:this.range,customDisabled:this.customDisabled,ripple:!1},ref:"calendar",on:{input:n=>{this.localValue=n}},scopedSlots:{header:this.renderCalendarHeader}})}},render(){const e=arguments[0],{disabled:t,handleMouseenter:a,handleMouseleave:n}=this;return e("div",{class:[r(),t?r("--disabled"):null]},[e(h,{class:r("__popover"),attrs:{"date-picker-cover":!0,trigger:"manual",placement:"bottom-start",y:6,defaultStyle:!1},ref:"popover",on:{open:()=>this.$emit("open"),opened:()=>this.$emit("opened"),close:()=>this.$emit("close"),closed:()=>this.$emit("closed")},scopedSlots:{trigger:this.renderInput}},[e("label",{class:r("__popover-inner"),attrs:{for:this.id},on:{mouseenter:a,mouseleave:n}},[this.renderCalendar(),e("div",{class:r("__actions"),on:{click:this.focus}},[e(s,{class:r("__now-button"),attrs:{type:"primary",size:"small"},on:{click:this.toNow}},["Now"]),e(s,{class:r("__confirm-button"),attrs:{type:"primary",size:"small",disabled:this.invalidRangeValue()},on:{click:()=>this.confirm(this.localValue)}},["OK"])])])])])}});export{B as D};
