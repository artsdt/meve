var H=Object.defineProperty,L=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var T=(t,e,i)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,p=(t,e)=>{for(var i in e||(e={}))$.call(e,i)&&T(t,i,e[i]);if(C)for(var i of C(e))B.call(e,i)&&T(t,i,e[i]);return t},W=(t,e)=>L(t,M(e));import{T as D}from"./index.67b6592b.js";import{r as N}from"./index.a69ac3c6.js";import{c as A}from"./create.af6e9796.js";import{d as O,g as v,b as P,t as E}from"./elements.aa4184a2.js";import{a as R,c as V}from"./relation.9e421618.js";import{c as _}from"./zIndex.129c1588.js";/* empty css               */const X=t=>["hover","click","manual"].includes(t),Y=t=>["top","bottom","left","right","left-start","right-start","left-end","right-end","top-start","top-end","bottom-start","bottom-end"].includes(t),Z={trigger:{type:String,validator:X,default:"hover"},placement:{type:String,default:"bottom",validator:Y},disabled:{type:Boolean,default:!1},x:{type:[Number,String],default:0},y:{type:[Number,String],default:0},sameWidth:{type:Boolean,default:!1},defaultStyle:{type:Boolean,default:!0}};const{namespace:y,createComponent:j}=A("popover"),S={bottom:"top","bottom-start":"left top","bottom-end":"right top",top:"bottom","top-start":"left bottom","top-end":"right bottom",left:"right","left-start":"right top","left-end":"right bottom",right:"left","right-start":"left top","right-end":"left bottom"},et=j({mixins:[R("popover"),V("popover"),_("show")],props:Z,watch:{placement:{handler(t){if(this.localPlacement=t,this.show){this.open();return}this.inset=this.getDefaultInset()},immediate:!0}},data:()=>({triggerWidth:void 0,show:!1,inset:{},zIndex:N.zIndex++,closeAnimation:null,hover:!1,opener:null,closer:null,localPlacement:null,clickSelf:!1}),mounted(){window.addEventListener("resize",this.resize)},beforeDestroy(){document.removeEventListener("click",this.handleClickBlur),window.removeEventListener("resize",this.resize)},methods:{getDefaultInset(){return{transform:"scale(0.8)",transformOrigin:S[this.localPlacement],opacity:0}},handleClick(t){this.trigger!=="click"||this.disabled||(this.parent&&t.stopPropagation(),this.clickSelf=!0,document.addEventListener("click",this.handleClickBlur),this.closeSibling(),this.closeChildren(),this.open())},handleClickBlur(){if(this.clickSelf){this.clickSelf=!1;return}this.close()},handleMouseEnter(){this.trigger!=="hover"||this.disabled||(this.clearParentsCloser(),this.hover=!0,this.opener=setTimeout(this.open,100))},handleMouseLeave(){this.trigger!=="hover"||this.disabled||(this.hover=!1,clearTimeout(this.opener),this.closer=setTimeout(()=>{this.close(!0),this.checkParentsHoverDoClose()},250))},clearParentsCloser(){this.findParents().forEach(e=>clearTimeout(e.closer)),clearTimeout(this.closer)},findParents(){const t=[];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t},checkParentsHoverDoClose(){const t=this.findParents();t.some(e=>e.hover)||t.forEach(e=>e.close(!0))},closeSibling(){this.parent&&this.parent.children.forEach(t=>{t!==this&&t.close()})},closeChildren(){this.children.forEach(t=>t.close())},async open(){var t;this.show||(clearTimeout(this.closeAnimation),this.$emit("open"),(t=this.parent)==null||t.open(),this.show=!0,this.triggerWidth=this.$refs.trigger.offsetWidth,await O(),this.resize())},close(t=!1){!this.show||(this.trigger==="click"&&document.removeEventListener("click",this.handleClickBlur),this.$emit("close"),this.resizeDefault(),t||this.closeChildren(),this.closeAnimation=setTimeout(()=>{this.closeAnimation&&(this.show=!1,this.$emit("closed"))},250))},resize(){!this.show||(this.inset=this.getInset())},resizeDefault(){this.inset=p(p({},this.inset),this.getDefaultInset())},computeInset(t,e,i,h,d){let o=0,s=0;const l=t.offsetWidth,n=t.offsetHeight,a=e.offsetWidth,c=e.offsetHeight;return["bottom","top"].includes(i)&&(s-=a/2),["left","left-start","left-end","top-end","bottom-end"].includes(i)&&(s-=a),["top","top-start","top-end","left-end","right-end"].includes(i)&&(o-=c),["left","right"].includes(i)&&(o-=c/2),["bottom","left-end","right-end","bottom-start","bottom-end"].includes(i)&&(o=o+v(t)+n),["top","top-start","top-end","left-start","right-start"].includes(i)&&(o+=v(t)),["left","right"].includes(i)&&(o=o+v(t)+n/2),["left","left-start","left-end","top-start","bottom-start"].includes(i)&&(s+=P(t)),["right","right-start","right-end","top-end","bottom-end"].includes(i)&&(s=s+P(t)+l),["bottom","top"].includes(i)&&(s=s+P(t)+l/2),{top:Math.floor(o+d),left:Math.floor(s+h)}},getInset(){this.localPlacement=this.placement;const{trigger:t,container:e}=this.$refs;if(!t||!e)return{};this.triggerWidth=this.$refs.trigger.offsetWidth;const i=document.body.scrollWidth,h=document.body.scrollHeight,d=e.offsetWidth,o=e.offsetHeight;let{x:s,y:l}=this;s=E(s),l=E(l);const{left:n,top:a}=this.computeInset(t,e,this.localPlacement,s,l),c=n+d,w=a+o,k=w<=h&&a>=0,x=n>=0&&c<=i,m=n<0,u=c>i,g=a<0,b=w>h,{localPlacement:r}=this,f=/(-\w+)|$/;m&&k?this.localPlacement=r.includes("left")?r.replace("left","right"):r.replace(f,"-start"):u&&k?this.localPlacement=r.includes("right")?r.replace("right","left"):r.replace(f,"-end"):g&&x?this.localPlacement=r.includes("top")?r.replace("top","bottom"):r.replace(f,"-start"):b&&x?this.localPlacement=r.includes("bottom")?r.replace("bottom","top"):r.replace(f,"-end"):m&&b?this.localPlacement="right-end":m&&g?this.localPlacement="right-start":u&&g?this.localPlacement="left-start":u&&b&&(this.localPlacement="left-end");const{top:I,left:z}=this.computeInset(t,e,this.localPlacement,s,l);return{top:I+"px",left:z+"px",transform:"scale(1)",transformOrigin:S[this.localPlacement]}},handleTransitionEnd(t){t.propertyName==="opacity"&&t.currentTarget===t.target&&window.getComputedStyle(t.currentTarget).opacity==="1"&&this.$emit("opened")}},render(){const t=arguments[0],{show:e,inset:i,zIndex:h,defaultStyle:d,sameWidth:o,triggerWidth:s,handleClick:l,handleMouseEnter:n,handleMouseLeave:a,handleTransitionEnd:c}=this;return t("div",{ref:"trigger",class:y(),on:{click:l,mouseenter:n,mouseleave:a}},[this.slots("trigger"),t(D,{ref:"teleport",attrs:{to:"body"}},[t("div",{ref:"container",class:[y("__container"),d?y("--default-style"):null],style:W(p({},i),{zIndex:h,width:o?`${s}px`:void 0}),on:{transitionend:c,mouseenter:n,mouseleave:a,click:l},directives:[{name:"show",value:e}]},[this.slots()])])])}});export{et as P};
