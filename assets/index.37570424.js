import{I as h}from"./index.c2868c0e.js";import{F as u}from"./index.f9508539.js";import{P as m}from"./index.fa8e81d3.js";import{S as f}from"./index.f3581791.js";import{T as b}from"./index.2714f115.js";import{K as g}from"./keyboardActive.acc7335a.js";import{c}from"./create.aa899411.js";import{a as v,c as p}from"./relation.9e421618.js";import{i as d,e as y,l as $}from"./shared.3ed6fcb1.js";import{c as k}from"./lock.6e857d47.js";/* empty css               *//* empty css                 */import{R as I}from"./index.45eae9d1.js";const x=e=>["normal","small","mini"].includes(e),T={value:{type:[String,Number,Array]},label:{type:[String,Number]},size:{type:String,default:"normal",validator:x},multiple:{type:Boolean,default:!1},placeholder:{type:String},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},validateTrigger:{type:Array,default:()=>["onSelect","onClear","onTagClose"]},rules:{type:Array}};let S=0;const{createComponent:C,namespace:i}=c("select"),A={normal:"small",small:"small",mini:"mini"},N=C({mixins:[g,k("locked"),v("select",{childrenKey:"options"}),p("form",{parentKey:"form",childrenKey:"formComponents"})],props:T,data:()=>({id:`m-select-${S++}`,isFocus:!1,errorMessage:"",keyboardActiveIndex:0,keyboardLastIndex:0,keyboardDisabledIndexes:[],keyboardDisabled:!1,locked:!1}),watch:{options(){this.keyboardDisabledIndexes=[],this.keyboardLastIndex=this.options.length?this.options.length-1:0,this.resetKeyboardActiveIndex(),this.options.forEach(e=>{e.disabled&&this.keyboardDisabledIndexes.push(e.index)}),setTimeout(this.resizeScroller)}},computed:{inputLabel(){return this.multiple||d(this.value)?"":this.findLabel(this.value)}},methods:{reset(){this.$emit("input",this.multiple?[]:void 0),this.resetValidation()},validate(){return this.$refs.formItem.validate()},resetValidation(){this.$refs.formItem.resetValidation()},focus(){this.$emit("focus"),this.open()},blur(){this.$emit("blur"),this.close()},open(){var t;const e=this.keyboardDisabledIndexes.length===this.options.length;((t=this.$refs.popover)==null?void 0:t.show)||this.options.length===0||e||(document.addEventListener("touchstart",this.blur),this.isFocus=!0,this.$refs.popover.open(),this.resetKeyboardActiveIndex(),setTimeout(this.resizeScroller))},close(){var e;!((e=this.$refs.popover)==null?void 0:e.show)||(this.isFocus=!1,document.removeEventListener("touchstart",this.blur),this.$refs.popover.close())},resetKeyboardActiveIndex(){this.keyboardActiveIndex=this.options.findIndex(e=>!e.disabled)},resizeScroller(){var e;!((e=this.$refs.popover)==null?void 0:e.show)||(this.$refs.scroller.resize(),this.$refs.scroller.scrollToTop())},nextTickValidateWithTrigger(e){this.$nextTick(()=>{var t;(t=this.$refs.formItem)==null||t.validateWithTrigger(this.validateTrigger,e,this.rules,this.value)})},findOption(e){return this.options.find(t=>t.index===e)},lockOnce(){this.locked=!0,requestAnimationFrame(()=>{this.locked=!1})},handleKeydownArrow(){var n;if(!this.$refs.popover.show)return;this.lockOnce();const e=(n=this.options.find(l=>l.index===this.keyboardActiveIndex))==null?void 0:n.$el,{offsetTop:t,offsetHeight:s}=e,r=this.$refs.scroller.getScrollTop(),o=this.$refs.scroller.$el.offsetHeight;t<r&&this.$refs.scroller.scrollTo(t),t+s>o&&this.$refs.scroller.scrollTo(t)},handleKeydownEnter(e){!this.$refs.popover.show||this.onOptionSelect(this.findOption(e))},handleKeydownEscape(){!this.$refs.popover.show||(this.$emit("blur"),this.close())},handleClick(e){var t,s;((t=this.form)==null?void 0:t.disabled)||this.disabled||(this.$emit("click",e),this.nextTickValidateWithTrigger("onClick"),!(((s=this.form)==null?void 0:s.readonly)||this.readonly)&&(this.$emit("focus"),this.open()))},handleErrorMessageChange(e){this.errorMessage=e},handleFocus(){var e,t;((e=this.form)==null?void 0:e.disabled)||((t=this.form)==null?void 0:t.readonly)||this.disabled||this.readonly||(this.$emit("focus"),this.open())},handleClear(e){var t,s;e.stopPropagation(),!(((t=this.form)==null?void 0:t.disabled)||((s=this.form)==null?void 0:s.readonly)||this.disabled||this.readonly)&&(this.$emit("input",this.multiple?[]:void 0),this.$emit("clear",this.multiple?[]:void 0),this.nextTickValidateWithTrigger("onClear"))},handleClose(e){const t=[...this.value];y(t,e),this.$emit("input",t),this.$emit("tag-close",t),this.nextTickValidateWithTrigger("onTagClose")},onOptionEnter(e){this.keyboardActiveIndex=e.index},onOptionSelect(e){var s;const t=(s=e.value)!=null?s:e.label;if(this.multiple){const r=[...this.value];$(r,t),this.$emit("input",r),this.$emit("select",r)}else this.$emit("input",t),this.$emit("select",t),this.blur();this.nextTickValidateWithTrigger("onSelect")},findLabel(e){let t=this.options.find(s=>s.value===e);return t||(t=this.options.find(s=>s.label===e)),t==null?void 0:t.label},renderClearIcon(){const e=this.$createElement;if(this.clearable)return e(h,{attrs:{"input-cover":!0,name:"close-circle"},class:[i("__clear-icon"),d(this.value)?null:i("--clear-icon-visible")],on:{click:this.handleClear}})},renderPrependIcon(){if(this.hasSlots("prepend-icon"))return this.slots("prepend-icon")},renderAppendIcon(){if(this.hasSlots("append-icon"))return this.slots("append-icon")},renderInput(){var t;return this.$createElement("input",{attrs:{id:this.id,autoComplete:"off",type:this.type,placeholder:this.placeholder,disabled:((t=this.form)==null?void 0:t.disabled)||this.disabled,readOnly:!0},class:i("__input"),domProps:{value:this.inputLabel},on:{focus:this.handleFocus}})},renderArrowIcon(){return this.$createElement(h,{class:i("__arrow"),attrs:{"select-cover":!0,name:"menu-down"}})},renderTags(){var r;const e=this.$createElement,t=this.value.map(o=>{var n,l;return e(b,{class:i("__tag"),attrs:{type:"primary",size:A[this.size],closeable:!0,disabled:((n=this.form)==null?void 0:n.disabled)||this.disabled,readonly:((l=this.form)==null?void 0:l.readonly)||this.readonly,"select-cover":!0},on:{close:()=>this.handleClose(o)}},[this.findLabel(o)])}),s=e("input",{class:i("__placeholder"),attrs:{placeholder:this.placeholder,disabled:((r=this.form)==null?void 0:r.disabled)||this.disabled,readOnly:!0}});return e("div",{class:i("__tags"),style:{paddingBottom:this.value.length?void 0:0}},[this.value.length?t:s])},renderSelect(){var t,s;return this.$createElement("div",{class:[i("__select"),i(`--${this.size}`),((t=this.form)==null?void 0:t.disabled)||this.disabled?null:i("--outline-hover"),((s=this.form)==null?void 0:s.disabled)||this.disabled?i("--disabled"):null,this.isFocus?i("--outline"):null,this.errorMessage?i("--validation-error-border"):null],on:{click:this.handleClick}},[this.renderPrependIcon(),this.multiple?this.renderTags():this.renderInput(),this.renderClearIcon(),this.renderAppendIcon(),this.renderArrowIcon()])}},render(){const e=arguments[0],{id:t}=this;return e("div",{class:[i(),"m--box"],on:{touchstart:s=>s.stopPropagation()}},[e(u,{ref:"formItem",attrs:{label:this.label,value:this.value,rules:this.rules},on:{"error-message-change":this.handleErrorMessageChange}},[e(m,{class:i("__popover"),attrs:{"select-cover":!0,trigger:"manual",y:6,sameWidth:!0,defaultStyle:!1},ref:"popover",on:{open:()=>this.$emit("open"),opened:()=>this.$emit("opened"),close:()=>this.$emit("close"),closed:()=>this.$emit("closed")},scopedSlots:{trigger:this.renderSelect}},[e("label",{attrs:{for:t},class:[i("__options"),i(`--${this.size}-options`)],on:{touchstart:s=>s.stopPropagation()}},[e(f,{ref:"scroller",attrs:{height:200}},[this.slots()])])])])])}}),_={label:{},value:{},disabled:{type:Boolean,default:!1}};const{createComponent:E,namespace:a}=c("option"),R=E({mixins:[p("select",{parentKey:"select",childrenKey:"options"})],directives:{Ripple:I},props:_,computed:{selected(){var s,r,o;const e=(s=this.value)!=null?s:this.label,t=(r=this.select)==null?void 0:r.value;return((o=this.select)==null?void 0:o.multiple)?t.includes(e):t===e}},methods:{handleMouseenter(){var e;this.disabled||(e=this.select)==null||e.onOptionEnter(this)},handleClick(){var e;this.disabled||(e=this.select)==null||e.onOptionSelect(this)},renderLabel(){return this.hasSlots()?this.slots():this.label}},render(){const e=arguments[0],{index:t,selected:s,handleMouseenter:r,disabled:o,handleClick:n,select:l}=this;return e("div",{class:[a(),a(`--${l==null?void 0:l.size}`),o?a("--disabled"):null,t===(l==null?void 0:l.keyboardActiveIndex)?a("--key-active"):null,s?a("--selected"):null],on:{mouseenter:r,click:n},directives:[{name:"ripple",value:{disabled:o}}]},[this.renderLabel()])}});export{R as O,N as S};
