import{I as p}from"./index.c39b1305.js";import{I as o}from"./index.d9ebbb80.js";import{P as u}from"./index.ab660845.js";import{R as m}from"./index.45eae9d1.js";import{B as h}from"./index.f9e323e3.js";import{S as f}from"./index.e2c7ee07.js";import{d as l,c as v}from"./vendor.7c12ce6c.js";import{K as y}from"./keyboardActive.acc7335a.js";import{c as $}from"./create.af6e9796.js";import{c as g}from"./relation.9e421618.js";import{i as a,t as T}from"./shared.285cd5cf.js";/* empty css               */import"./index.69ee1880.js";const b=e=>["normal","small","mini"].includes(e),V={value:{type:[String,Number,Array]},label:{type:[String,Number]},size:{type:String,default:"normal",validator:b},placeholder:{type:String},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},valueFormat:{type:String,default:"HH:mm:ss"},customDisabled:{type:Function,default:()=>!1},ripple:{type:Boolean,default:!0},validateTrigger:{type:Array,default:()=>["onChange","onClear"]},rules:{type:Array}};l.extend(v);const{createComponent:k,namespace:s}=$("time-picker"),_=Array.from({length:60},(e,i)=>i<10?"0"+i:""+i),c="HH:mm:ss",d="1970-01-01",P="YYYY-MM-DD",A=23,R=k({mixins:[y,g("form",{parentKey:"form",childrenKey:"formComponents"})],props:V,directives:{Ripple:m},data:()=>({enterPopover:!1,keyboardDisabled:!1,id:void 0,panelValues:[]}),watch:{value:{handler(){this.syncValueEffect()},immediate:!0}},computed:{invalidDisplayValue(){return this.panelValues.some((e,i)=>this.customDisabled(i,e))},displayValue(){return this.panelValues.join(":")}},mounted(){this.id=this.$refs.input.id},methods:{reset(){this.$emit("input",void 0),this.resetValidation()},validate(){this.$refs.input.validate()},resetValidation(){this.$refs.input.resetValidation()},nextTickValidateWithTrigger(e){!this.validateTrigger.includes(e)||this.$nextTick(()=>{this.validate()})},focus(){this.$refs.input.focus()},blur(){var e;(e=this.$refs.input)==null||e.blur()},open(){this.$refs.popover.show||(this.$refs.popover.open(),this.keyboardDisabled=!1,this.scrollAllToTop(),this.focus())},close(){var e,i;!((e=this.$refs.popover)==null?void 0:e.show)||((i=this.$refs.popover)==null||i.close(),this.keyboardDisabled=!0,this.syncValueEffect(),this.blur())},handleKeydownEscape(){if(!this.invalidDisplayValue){this.confirm();return}this.close()},syncValueEffect(){this.panelValues=a(this.value)?[]:l(`${d} ${this.value}`,`${P} ${this.valueFormat}`).format(c).split(":")},toNow(){this.panelValues=l().format(c).split(":"),this.scrollAllToTop()},scrollAllToTop(){this.panelValues.forEach((e,i)=>{this.scrollToTop(i,e)})},confirm(){const e=a(this.displayValue)?void 0:l(`${d} ${this.displayValue}`).format(this.valueFormat);this.value!==e&&(this.$emit("input",e),this.$emit("change",e),this.nextTickValidateWithTrigger("onChange")),this.close(),requestAnimationFrame(this.blur)},scrollToTop(e,i){this.$refs[`scroller-${e}`].disableTransitionDuration(),requestAnimationFrame(()=>{this.$refs[`scroller-${e}`]&&(this.$refs[`scroller-${e}`].resize(),this.$refs[`scroller-${e}`].scrollTo(this.$refs[`${e}-${i}`].offsetTop))})},updatePanelValues(e,i){this.panelValues=this.panelValues.map((t,r)=>r===e?i:t)},handleClick(e){var i,t;((i=this.form)==null?void 0:i.disabled)||this.disabled||(this.$emit("click",e),this.nextTickValidateWithTrigger("onClick"),!(((t=this.form)==null?void 0:t.readonly)||this.readonly)&&this.focus())},handleFocus(e){var i,t;((i=this.form)==null?void 0:i.disabled)||this.disabled||(this.$emit("focus",e),!(((t=this.form)==null?void 0:t.readonly)||this.readonly)&&this.open())},handleBlur(e){if(this.$emit("blur",e),!this.enterPopover){if(!this.invalidDisplayValue){this.confirm();return}this.close()}},handleClear(){this.$emit("clear",void 0),this.$emit("input",void 0),this.$emit("change",void 0),this.nextTickValidateWithTrigger("onClear"),this.nextTickValidateWithTrigger("onChange")},handleMouseenter(){this.enterPopover=!0},handleMouseleave(){this.enterPopover=!1},handleTimeClick(e,i,t){t||(a(this.panelValues)&&this.toNow(),this.scrollToTop(e,i),this.updatePanelValues(e,i))},renderTimes(e){const i=this.$createElement,t=_.map(r=>{if(e===0&&T(r)>A)return;const n=this.customDisabled(e,r);return i("div",{class:[s("__time"),n?s("--time-disabled"):null,this.panelValues[e]===r?s("--active"):null],ref:`${e}-${r}`,directives:[{name:"ripple",value:{disabled:this.ripple||n}}],on:{click:()=>this.handleTimeClick(e,r,n)}},[r])});return t.push(i("div",{class:s("--space")})),t},renderTimePanel(){const e=this.$createElement;return e("div",{class:s("__time-panel-container")},[Array.from({length:3},(i,t)=>e(f,{class:s("__time-panel"),ref:`scroller-${t}`,attrs:{right:0,height:210}},[this.renderTimes(t)]))])},renderAppendIcon(){const e=this.$createElement,i=e(o,{attrs:{"time-picker-cover":!0,name:"clock-outline"},class:s("__clock-icon")}),t=this.clearable&&e(o,{attrs:{"time-picker-cover":!0,name:"close-circle"},class:[s("__clear-icon"),a(this.value)?s("--hide-clear-icon"):null],on:{click:this.handleClear}});return e("div",{class:s("__append-icon"),on:{click:r=>r.stopPropagation()}},[t,this.hasSlots("append-icon")?this.slots("append-icon"):i])},renderInput(){var i;return this.$createElement(p,{attrs:{"time-picker-cover":!0,size:this.size,value:this.displayValue,validateValue:this.value,label:this.label,validateTrigger:this.validateTrigger,rules:this.rules,placeholder:this.placeholder,size:this.size,readonly:!0,disabled:((i=this.form)==null?void 0:i.disabled)||this.disabled},class:this.invalidDisplayValue?s("--invalid-display-value"):null,ref:"input",on:{clear:this.handleClear,focus:this.handleFocus,blur:this.handleBlur,click:this.handleClick},scopedSlots:{"prepend-icon":()=>this.slots("prepend-icon"),"append-icon":this.renderAppendIcon}})}},render(){const e=arguments[0],{disabled:i,handleMouseenter:t,handleMouseleave:r}=this;return e("div",{class:[s(),i?s("--disabled"):null]},[e(u,{class:s("__popover"),attrs:{"time-picker-cover":!0,trigger:"manual",placement:"bottom-start",y:6,defaultStyle:!1},ref:"popover",on:{open:()=>this.$emit("open"),opened:()=>this.$emit("opened"),close:()=>this.$emit("close"),closed:()=>this.$emit("closed")},scopedSlots:{trigger:this.renderInput}},[e("label",{class:s("__popover-inner"),attrs:{for:this.id},on:{mouseenter:t,mouseleave:r}},[this.renderTimePanel(),e("div",{class:s("__actions"),on:{click:this.focus}},[e(h,{attrs:{type:"primary",size:"small"},on:{click:this.toNow}},["Now"]),e(h,{attrs:{type:"primary",size:"small",disabled:this.invalidDisplayValue},on:{click:this.confirm}},["OK"])])])])])}});export{R as T};
